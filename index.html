<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/CSS" href="style.css">
    <title>My trip to Pitalkhora</title>
</head>

<body>
    <div class="main-tabel">
        <header>
            <h3 class="title">~*~ LOST IN PITALKHORA ~*~</h3>
            <div class="marquee-container">
                <div class="marquee-text">
                    Wlecome to my homepage!!! *** Upadates are underway**
                </div>
            </div>
        </header>

        <!-- now i will add content -->
        <hr>
        <div class="main-content">
            <img src="hello-shy.gif">
            <br>
            <h3 class="button" style="color: black;"><b>MY TRAVEL ENTRY</b></h3>
            <p>
                <span style="color: cyan;">Hello my dear friend</span><br>
                Hi guys I am a curious person about the past and life of that time.<br>
                Due to such curiosity i learnt about a place called Pitalkhora!!<br>
                So in my winter sem break i decided to visit it with my friend and explore<br>
                The place was truly amazing in eyes. When i first saw it while going down the stairs,<br>
                I was thrilled to seee what secrects that place holds!!!!<br>
            </p>

            <hr>
            <h3 class="button" style="color: black;"><b>~*~ GALLERY ~*~</b></h3>
            <P><i>Click on thymbnail to enlarge</i></P>
            <div class="gallery">
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 1</div>
                </div>
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 2</div>
                </div>
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 3</div>
                </div>
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 4</div>
                </div>
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 5</div>
                </div>
                <div class="gallery-item" onclick="openLightbox(this)">
                    <!-- Now the images and video -->
                    <img src="Painting Idea Acrylic.jpg">
                    <div style="color: black;">Image 6</div>
                </div>
            </div>
        </div>

        <h2 class="button" style="color: black;">LINKS</h2>
        <p>
            <a href="#">[Email Me]</a> |
            <a href="#">[My Friends]</a> |
            <a href="#">[Web Ring]</a>
        </p>
        <hr>
        <div class="guestbook-section">
            <h3 style="color: #00FF00; text-shadow: 0 0 5px #00FF00;">~*~ VISITOR LOG ~*~</h3>

            <div class="guestbook-form">
                <input type="text" id="nameInput" placeholder="CODENAME">
                <input type="text" id="msgInput" placeholder="TRANSMISSION DATA">
                <button id="uploadBtn" type="button">UPLOAD</button>
            </div>

            <div id="messages-list">
                <p style="color: gray;">Loading transmissions...</p>
            </div>
        </div>
        <footer>
            This site was made on Jan @ 2026 <br>
            Last updated : 17/01/26<br>
            Thanks for visiting &#59;&#41;
        </footer>
    </div>

    <!-- lightbox ui -->
    <div class="lightbox" id="lightbox">
        <span class="close-btn" onclick="closeLightbox()">[X] CLOSE</span>
        <img id="lightbox-img" src="" alt="Full-screen">
    </div>
    <script>
    const API_URL = "http://localhost:5000/api";

    document.addEventListener("DOMContentLoaded", () => {
        msgInput.addEventListener("keypress", (event) => {
    if (event.key === "Enter") {
        postMessage();
    }
});
        // 1. Attach the click event properly
        const uploadBtn = document.getElementById('uploadBtn');
        if (uploadBtn) {
            uploadBtn.addEventListener('click', postMessage);
        }

        // 2. Load messages only ONCE when the page is ready
        loadMessages();
        
        // Removed the extra loadMessages() call from the bottom
    });

    const lightbox = document.getElementById('lightbox');
    const lightboximg = document.getElementById('lightbox-img');

    function openLightbox(element) {
        const img = element.querySelector('img');
        lightboximg.src = img.src;
        lightbox.style.display = 'flex';
    }

    function closeLightbox() {
        lightbox.style.display = 'none';
    }

    // Lightbox and keyboard logic...
    lightbox.addEventListener('click', e => {
        if (e.target !== e.currentTarget) return;
        closeLightbox();
    });

    document.addEventListener('keydown', function (event) {
        if (event.key == "Escape") {
            closeLightbox();
        }
    });

    async function loadMessages() {
        try {
            const response = await fetch(`${API_URL}/messages`);
            const messages = await response.json();
            const list = document.getElementById('messages-list');
            list.innerHTML = ""; 

            if (messages.length === 0) {
                list.innerHTML = "<p>No transmissions yet. Be the first.</p>";
                return;
            }

            messages.forEach(msg => {
                const entry = document.createElement('div');
                entry.className = "msg-entry";
                entry.innerHTML = `<span style="color: cyan;">[${msg[0]}]</span>: ${msg[1]}`;
                list.appendChild(entry);
            });
        } catch (error) {
            console.error("Error:", error);
            document.getElementById('messages-list').innerHTML =
                "<p style='color:red'>ERROR: SERVER OFFLINE. RUN 'python app.py'</p>";
        }
    }

    async function postMessage() {
        const nameInput = document.getElementById('nameInput');
        const msgInput = document.getElementById('msgInput');

        const name = nameInput.value.trim(); // Added .trim() to prevent space-only posts
        const msg = msgInput.value.trim();

        if (!name || !msg) {
            alert("DEBUG: Who called me? " + postMessage.caller);
            return;
        }

        try {
            await fetch(`${API_URL}/sign`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, message: msg })
            });

            nameInput.value = "";
            msgInput.value = "";
            loadMessages();
        } catch (error) {
            alert("Could not connect to server!");
        }
    }
</script>

</body>
</html>
